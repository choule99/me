---
interface Props {
  company: string;
  title: string;
  dates: string;
  description: string;
}

const { company, title, dates, description } = Astro.props;
---

<div class="relative pl-8 pb-12 last:pb-0 group">
  <!-- Timeline line -->
  <div class="absolute left-0 top-2 bottom-0 w-px bg-indigo-200 group-last:hidden"></div>

  <!-- Timeline dot -->
  <div class="absolute left-0 top-2 w-2 h-2 -translate-x-[3px] rounded-full bg-indigo-500 ring-4 ring-indigo-100"></div>

  <!-- Content -->
  <div class="bg-white rounded-2xl p-6 shadow-card hover:shadow-card-hover transition-shadow border border-gray-100">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-3">
      <div>
        <h3 class="text-xl font-semibold text-gray-900">{company}</h3>
        <p class="text-indigo-600 font-medium">{title}</p>
      </div>
      <span class="text-sm text-gray-500 font-medium whitespace-nowrap">{dates}</span>
    </div>
    <p class="text-gray-600 leading-relaxed">{description}</p>

    <!-- Collapsible details -->
    <div class="experience-details">
      <div class="experience-details-content overflow-hidden max-h-0 transition-[max-height] duration-300 ease-in-out">
        <slot />
      </div>
      <button
        type="button"
        class="experience-toggle mt-3 text-sm text-indigo-600 hover:text-indigo-800 font-medium cursor-pointer flex items-center gap-1 transition-colors"
      >
        <svg class="experience-toggle-icon w-4 h-4 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
        </svg>
        <span class="experience-toggle-label"></span>
      </button>
    </div>
  </div>
</div>

<script>
  function initExperienceToggles() {
    document.querySelectorAll('.experience-details').forEach((details) => {
      const content = details.querySelector('.experience-details-content') as HTMLElement;
      const icon = details.querySelector('.experience-toggle-icon') as HTMLElement;
      const label = details.querySelector('.experience-toggle-label') as HTMLElement;
      const button = details.querySelector('.experience-toggle') as HTMLElement;

      if (!content || !button || !label) return;

      // Determine labels based on lang
      const isFrench = document.documentElement.lang === 'fr';
      const showText = isFrench ? 'Voir plus' : 'Show more';
      const hideText = isFrench ? 'Voir moins' : 'Show less';

      label.textContent = showText;
      let expanded = false;

      button.addEventListener('click', () => {
        expanded = !expanded;
        if (expanded) {
          content.style.maxHeight = content.scrollHeight + 'px';
          icon?.classList.add('rotate-180');
          label.textContent = hideText;
        } else {
          content.style.maxHeight = '0';
          icon?.classList.remove('rotate-180');
          label.textContent = showText;
        }
      });
    });
  }

  // Run on initial load and on Astro page transitions
  initExperienceToggles();
  document.addEventListener('astro:after-swap', initExperienceToggles);
</script>
